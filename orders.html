<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¢å•ç®¡ç† | Shop</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 20px;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #ff6b6b;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #ff6b6b;
      color: white;
    }
    .item-list {
      text-align: left;
    }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

    // âœ… ç¡®ä¿è¿™é‡Œä½¿ç”¨çš„æ˜¯ä½ çš„ Firebase é…ç½®
    const firebaseConfig = {
        apiKey: "AIzaSyCh7tgqEZb1zLICy6trriTCMJlXEe0x6hM",
        authDomain: "shop-87351.firebaseapp.com",
        projectId: "shop-87351",
        storageBucket: "shop-87351.firebasestorage.app",
        messagingSenderId: "994764608061",
        appId: "1:994764608061:web:e7a5a041cd3e082daad054"
    };

    // âœ… åˆå§‹åŒ– Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // âœ… æµ‹è¯•æ˜¯å¦æˆåŠŸåŠ è½½ Firebase
    console.log("ğŸ”¥ Firebase å·²åŠ è½½:", app);
    console.log("ğŸ“‚ Firestore å·²åŠ è½½:", db);
</script>

  
  <script type="module">
    // å¯¼å…¥ Firebase æ¨¡å—ï¼ˆä½¿ç”¨ v9.15.0 ç‰ˆï¼‰
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // Firebase é…ç½®ï¼ˆè¯·ç¡®ä¿é…ç½®æ­£ç¡®ï¼Œå¦‚æœæœ‰éœ€è¦è¯·æ›´æ–° storageBucket å€¼ï¼‰  
    const firebaseConfig = {
      apiKey: "AIzaSyCh7tgqEZb1zLICy6trriTCMJlXEe0x6hM",
      authDomain: "shop-87351.firebaseapp.com",
      projectId: "shop-87351",
      storageBucket: "shop-87351.firebasestorage.app",  // æ³¨æ„ï¼šé€šå¸¸åº”ä¸º shop-87351.appspot.comï¼Œè¯·æ ¹æ®ä½ çš„å®é™…æƒ…å†µè°ƒæ•´
      messagingSenderId: "994764608061",
      appId: "1:994764608061:web:e7a5a041cd3e082daad054"
    };

    // åˆå§‹åŒ– Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // åŠ è½½è®¢å•æ•°æ®ï¼Œå¹¶æ˜¾ç¤ºåœ¨è¡¨æ ¼ä¸­
    async function loadOrders() {
      const ordersTableBody = document.getElementById("orders-table-body");
      ordersTableBody.innerHTML = "<tr><td colspan='8'>åŠ è½½ä¸­...</td></tr>";

      try {
        // æ„é€ æŸ¥è¯¢ï¼šæŒ‰ timestamp é™åºæ’åˆ—ï¼ˆæœ€æ–°è®¢å•åœ¨å‰ï¼‰
        const ordersRef = collection(db, "orders");
        const q = query(ordersRef, orderBy("timestamp", "desc"));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          ordersTableBody.innerHTML = "<tr><td colspan='8'>æš‚æ— è®¢å•</td></tr>";
          return;
        }

        let html = "";
        querySnapshot.forEach((doc) => {
          const order = doc.data();

          // æ ¼å¼åŒ–è®¢å•æ—¶é—´
          let orderTime = "æœªçŸ¥";
          if (order.timestamp) {
            // å¦‚æœ timestamp æ˜¯ Firestore Timestamp å¯¹è±¡
            if (order.timestamp.toDate) {
              orderTime = order.timestamp.toDate().toLocaleString("zh-CN");
            } else {
              // å¦‚æœæ˜¯ ISO å­—ç¬¦ä¸²æˆ–æ•°å­—
              orderTime = new Date(order.timestamp).toLocaleString("zh-CN");
            }
          }

          // ç”Ÿæˆå•†å“è¯¦æƒ… HTML
          let itemsHtml = "";
          if (order.items && Array.isArray(order.items)) {
            order.items.forEach(item => {
              itemsHtml += `<p>${item.name} - ï¿¥${item.price} x ${item.quantity}</p>`;
            });
          }

          html += `
            <tr>
              <td>${order.ordersnumber || "æœªçŸ¥"}</td>
              <td>${order.customer ? order.customer.name : "æœªçŸ¥"}</td>
              <td>${order.customer ? order.customer.email : "æœªçŸ¥"}</td>
              <td>${order.customer ? order.customer.phone : "æœªçŸ¥"}</td>
              <td>${order.customer ? order.customer.address : "æœªçŸ¥"}</td>
              <td>${orderTime}</td>
              <td>ï¿¥${order.total || 0}</td>
              <td class="item-list">${itemsHtml}</td>
            </tr>
          `;
        });

        ordersTableBody.innerHTML = html;
      } catch (error) {
        console.error("åŠ è½½è®¢å•å¤±è´¥ï¼š", error);
        ordersTableBody.innerHTML = "<tr><td colspan='8'>åŠ è½½è®¢å•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</td></tr>";
      }
    }

    document.addEventListener("DOMContentLoaded", loadOrders);
  </script>
</head>
<body>
  <h1>è®¢å•ç®¡ç†</h1>
  <table>
    <thead>
      <tr>
        <th>è®¢å•å·</th>
        <th>å®¢æˆ·å§“å</th>
        <th>å®¢æˆ·é‚®ç®±</th>
        <th>ç”µè¯</th>
        <th>åœ°å€</th>
        <th>è®¢å•æ—¶é—´</th>
        <th>æ€»ä»·</th>
        <th>å•†å“è¯¦æƒ…</th>
      </tr>
    </thead>
    <tbody id="orders-table-body">
      <!-- è®¢å•æ•°æ®ä¼šåœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
    </tbody>
  </table>
</body>
</html>
