<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢å•åˆ—è¡¨ | Shop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
        }
        th {
            background-color: #f4f4f4;
        }
        .details {
            display: none;
            text-align: left;
        }
        button {
            cursor: pointer;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
    <script type="module">
        // âœ… å¼•å…¥ Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // âœ… Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCh7tgqEZb1zLICy6trriTCMJlXEe0x6hM",
            authDomain: "shop-87351.firebaseapp.com",
            projectId: "shop-87351",
            storageBucket: "shop-87351.appspot.com",
            messagingSenderId: "994764608061",
            appId: "1:994764608061:web:e7a5a041cd3e082daad054"
        };

        // âœ… åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // âœ… è·å– `orders` æ•°æ®
        async function loadOrders() {
            const ordersTableBody = document.getElementById("orders-table-body");
            ordersTableBody.innerHTML = "<tr><td colspan='8'>åŠ è½½ä¸­...</td></tr>";

            try {
                const ordersCollection = collection(db, "orders");
                const ordersSnapshot = await getDocs(ordersCollection);
                
                let ordersHtml = "";
                
                ordersSnapshot.forEach((doc) => {
                    const order = doc.data();
                    const { customer, items, ordersnumber, timestamp, total } = order;

                    // âœ… æ ¼å¼åŒ–æ—¶é—´
                    const date = timestamp ? new Date(timestamp) : "æœªçŸ¥";
                    const formattedDate = date instanceof Date ? date.toLocaleString("zh-CN") : "æœªçŸ¥";

                    // âœ… ç”Ÿæˆ HTML ä»£ç 
                    ordersHtml += `
                        <tr>
                            <td>${ordersnumber || "æœªçŸ¥"}</td>
                            <td>${customer.name || "æœªçŸ¥"}</td>
                            <td>${customer.email || "æœªçŸ¥"}</td>
                            <td>${customer.phone || "æœªçŸ¥"}</td>
                            <td>${customer.address || "æœªçŸ¥"}</td>
                            <td>${formattedDate}</td>
                            <td>ï¿¥${total || 0}</td>
                            <td>
                                <button onclick="toggleItems('${doc.id}')">æŸ¥çœ‹</button>
                                <div id="items-${doc.id}" class="details">
                                    ${items.map(item => `
                                        <p>ğŸ“Œ ${item.name} - ï¿¥${item.price} x ${item.quantity}</p>
                                    `).join("")}
                                </div>
                            </td>
                        </tr>
                    `;
                });

                ordersTableBody.innerHTML = ordersHtml;
            } catch (error) {
                console.error("âŒ åŠ è½½è®¢å•å¤±è´¥:", error);
                ordersTableBody.innerHTML = "<tr><td colspan='8'>âŒ åŠ è½½å¤±è´¥</td></tr>";
            }
        }

        // âœ… å±•å¼€/æŠ˜å å•†å“è¯¦æƒ…
        window.toggleItems = function(orderId) {
            const itemsDiv = document.getElementById(`items-${orderId}`);
            itemsDiv.style.display = itemsDiv.style.display === "none" ? "block" : "none";
        };

        // âœ… é¡µé¢åŠ è½½å®Œæˆåè·å–è®¢å•æ•°æ®
        document.addEventListener("DOMContentLoaded", loadOrders);
    </script>
</head>
<body>
    <h1>è®¢å•åˆ—è¡¨</h1>
    <table>
        <thead>
            <tr>
                <th>è®¢å•å·</th>
                <th>å®¢æˆ·å§“å</th>
                <th>å®¢æˆ·é‚®ç®±</th>
                <th>ç”µè¯</th>
                <th>åœ°å€</th>
                <th>è®¢å•æ—¶é—´</th>
                <th>æ€»ä»·</th>
                <th>å•†å“è¯¦æƒ…</th>
            </tr>
        </thead>
        <tbody id="orders-table-body">
            <!-- è®¢å•æ•°æ®ä¼šåœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
        </tbody>
    </table>
</body>
</html>
